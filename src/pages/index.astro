---
import BaseLayout from '../layouts/BaseLayout.astro'
import SearchBar from '../components/SearchBar'
import { supabase } from '../lib/supabase'
import type { MetaphorWithVotes } from '../lib/types'

// Fetch published metaphors sorted by score (likes - dislikes)
const { data: metaphors, error } = await supabase
  .from('metaphors_with_votes')
  .select('*')
  .eq('status', 'published')
  .order('score', { ascending: false })
  .returns<MetaphorWithVotes[]>()

if (error) {
  console.error('Error fetching metaphors:', error)
}
---

<BaseLayout>
  <div class="space-y-8">
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold mb-4">České metafory</h1>
      <p class="text-gray-600 max-w-2xl mx-auto">
        Objevte bohatství české řeči. Procházejte, vyhledávejte a přidávejte vlastní metafory.
      </p>
    </div>

    {metaphors && metaphors.length > 0 ? (
      <SearchBar client:load metaphors={metaphors} />
    ) : (
      <div class="text-center py-12 text-gray-500">
        <p>Zatím nejsou žádné metafory.</p>
        <a href="/pridat" class="text-blue-600 hover:text-blue-700 underline mt-2 inline-block">
          Přidejte první metaforu!
        </a>
      </div>
    )}
  </div>
</BaseLayout>
