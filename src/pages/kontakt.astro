---
import BaseLayout from '../layouts/BaseLayout.astro'
---

<BaseLayout
  title="Kontakt | Metafory.cz"
  description="Máte dotaz, nápad nebo připomínku? Napište nám!"
>
  <div class="max-w-4xl mx-auto px-5 sm:px-8">
    <!-- Back button -->
    <div class="mb-10">
      <a
        href="/"
        class="hover:opacity-70 transition-opacity inline-flex items-center gap-2 text-sm font-medium"
        style="color: var(--color-text-secondary);"
      >
        ← Zpět na seznam
      </a>
    </div>

    <div class="mb-12">
      <h1 class="font-bold mb-4 tracking-tight" style="color: var(--color-text-primary);">
        Kontakt
      </h1>
      <p class="text-lg leading-relaxed" style="color: var(--color-text-secondary);">
        Dotazy? Nápady? Připomínky? Šoupněte je do formuláře.
      </p>
    </div>

    <div class="rounded-xl p-8 sm:p-10" style="background-color: var(--color-bg-card); box-shadow: var(--shadow-sm);">

      <form id="contact-form" class="space-y-7">
        <!-- Jméno -->
        <div>
          <label for="jmeno" class="block text-base font-semibold mb-3" style="color: var(--color-text-primary);">
            Jméno <span style="color: var(--color-negative);">*</span>
          </label>
          <input
            type="text"
            id="jmeno"
            name="jmeno"
            required
            maxlength="100"
            placeholder="např. Jan Novák"
            class="w-full px-4 py-3 rounded-lg font-medium transition-all"
            style="border: 1px solid rgba(0, 0, 0, 0.1); background-color: white; color: var(--color-text-primary); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);"
            onfocus="this.style.borderColor='var(--color-accent-primary)'; this.style.boxShadow='0 0 0 3px rgba(82, 183, 136, 0.1)'"
            onblur="this.style.borderColor='rgba(0, 0, 0, 0.1)'; this.style.boxShadow='0 1px 3px rgba(0, 0, 0, 0.05)'"
          />
        </div>

        <!-- E-mail -->
        <div>
          <label for="email" class="block text-base font-semibold mb-3" style="color: var(--color-text-primary);">
            E-mail <span style="color: var(--color-negative);">*</span>
          </label>
          <input
            type="email"
            id="email"
            name="email"
            required
            maxlength="100"
            placeholder="email@priklad.cz"
            class="w-full px-4 py-3 rounded-lg font-medium transition-all"
            style="border: 1px solid rgba(0, 0, 0, 0.1); background-color: white; color: var(--color-text-primary); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);"
            onfocus="this.style.borderColor='var(--color-accent-primary)'; this.style.boxShadow='0 0 0 3px rgba(82, 183, 136, 0.1)'"
            onblur="this.style.borderColor='rgba(0, 0, 0, 0.1)'; this.style.boxShadow='0 1px 3px rgba(0, 0, 0, 0.05)'"
          />
        </div>

        <!-- Zpráva -->
        <div>
          <label for="zprava" class="block text-base font-semibold mb-3" style="color: var(--color-text-primary);">
            Zpráva <span style="color: var(--color-negative);">*</span>
          </label>
          <textarea
            id="zprava"
            name="zprava"
            required
            rows="6"
            maxlength="2000"
            placeholder="Vaše zpráva..."
            class="w-full px-4 py-3 rounded-lg font-medium transition-all"
            style="border: 1px solid rgba(0, 0, 0, 0.1); background-color: white; color: var(--color-text-primary); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);"
            onfocus="this.style.borderColor='var(--color-accent-primary)'; this.style.boxShadow='0 0 0 3px rgba(82, 183, 136, 0.1)'"
            onblur="this.style.borderColor='rgba(0, 0, 0, 0.1)'; this.style.boxShadow='0 1px 3px rgba(0, 0, 0, 0.05)'"
          ></textarea>
          <p class="text-xs mt-2" style="color: var(--color-text-tertiary);">Max 2000 znaků</p>
        </div>

        <!-- Honeypot field (hidden anti-spam) -->
        <div style="position: absolute; left: -5000px;" aria-hidden="true">
          <label for="website">
            Ochrana proti SPAMu - nechte pole prázdné
          </label>
          <input
            type="text"
            id="website"
            name="website"
            tabindex="-1"
            autocomplete="off"
          />
        </div>

        <!-- Submit button -->
        <div class="pt-6">
          <button
            type="submit"
            class="w-full font-bold py-4 px-6 rounded-lg hover:transform hover:scale-105 transition-all shadow-sm disabled:opacity-40 disabled:cursor-not-allowed disabled:transform-none"
            style="background-color: var(--color-accent-red); color: white;"
            onmouseover="if(!this.disabled) this.style.backgroundColor='var(--color-accent-red-hover)'"
            onmouseout="if(!this.disabled) this.style.backgroundColor='var(--color-accent-red)'"
          >
            Odeslat
          </button>
        </div>

        <!-- Status messages -->
        <div id="form-status" class="hidden"></div>
      </form>
    </div>
  </div>
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contact-form') as HTMLFormElement
    const statusDiv = document.getElementById('form-status') as HTMLDivElement
    const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement

    if (!form || !statusDiv || !submitButton) {
      console.error('Form elements not found')
      return
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault()

      // Disable submit button
      submitButton.disabled = true
      submitButton.textContent = 'Odesílám...'

      // Get form data
      const formData = new FormData(form)

      // Check honeypot field (anti-spam)
      const honeypot = formData.get('website') as string
      if (honeypot) {
        // Silently reject spam
        statusDiv.className = 'p-5 rounded-lg font-medium'
        statusDiv.style.backgroundColor = 'var(--color-bg-card)'
        statusDiv.style.color = 'var(--color-negative)'
        statusDiv.style.border = '1.5px solid var(--color-negative)'
        statusDiv.textContent = 'Chyba při odesílání. Zkuste to prosím znovu.'
        statusDiv.classList.remove('hidden')
        submitButton.disabled = false
        submitButton.textContent = 'Odeslat'
        return
      }

      const data = {
        jmeno: formData.get('jmeno') as string,
        email: formData.get('email') as string,
        zprava: formData.get('zprava') as string
      }

      try {
        const response = await fetch('/api/kontakt', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        })

        const result = await response.json()

        if (response.ok) {
          // Success
          statusDiv.className = 'p-5 rounded-lg font-medium'
          statusDiv.style.backgroundColor = 'var(--color-positive)'
          statusDiv.style.color = 'white'
          statusDiv.style.border = '1.5px solid var(--color-positive)'
          statusDiv.innerHTML = `
            <div class="font-bold mb-2">✅ Zpráva úspěšně odeslána!</div>
            <div class="text-sm opacity-95">Děkujeme za váš dotaz. Odpovíme vám co nejdříve.</div>
          `
          statusDiv.classList.remove('hidden')
          form.reset()
        } else {
          // Error
          statusDiv.className = 'p-5 rounded-lg font-medium'
          statusDiv.style.backgroundColor = 'var(--color-bg-card)'
          statusDiv.style.color = 'var(--color-negative)'
          statusDiv.style.border = '1.5px solid var(--color-negative)'
          statusDiv.textContent = result.error || 'Chyba při odesílání. Zkuste to prosím znovu.'
          statusDiv.classList.remove('hidden')
        }
      } catch (err) {
        statusDiv.className = 'p-5 rounded-lg font-medium'
        statusDiv.style.backgroundColor = 'var(--color-bg-card)'
        statusDiv.style.color = 'var(--color-negative)'
        statusDiv.style.border = '1.5px solid var(--color-negative)'
        statusDiv.textContent = 'Chyba připojení. Zkontrolujte prosím internetové připojení.'
        statusDiv.classList.remove('hidden')
      } finally {
        submitButton.disabled = false
        submitButton.textContent = 'Odeslat'
      }
    })
  })
</script>
