---
export const prerender = true

import BaseLayout from '../layouts/BaseLayout.astro'
---

<BaseLayout
  title="Přidat metaforu | Metafory.cz"
  description="Přidejte vlastní metaforu do naší databáze českých metafor"
>
  <div>
    <!-- Back button -->
    <div class="mb-10">
      <a
        href="/"
        class="hover:opacity-70 transition-opacity inline-flex items-center gap-2 text-sm font-medium"
        style="color: var(--color-text-secondary);"
      >
        ← Zpět na seznam
      </a>
    </div>

    <div class="mb-12">
      <h1 class="font-bold mb-4 tracking-tight" style="color: var(--color-text-primary);">
        Přidat novou metaforu
      </h1>
      <p class="text-lg leading-relaxed" style="color: var(--color-text-secondary);">
        Sdílejte svou oblíbenou českou metaforu.
      </p>
    </div>

    <!-- Approval notice -->
    <div class="mb-6 p-4 rounded-lg flex items-start gap-3" style="background-color: var(--color-bg-card); border: 1.5px solid var(--color-border);">
      <span style="color: var(--color-accent-primary-light); font-size: 1.25rem; flex-shrink: 0;">ℹ️</span>
      <p class="text-sm leading-relaxed" style="color: var(--color-text-secondary);">
        Nově přidané metafory procházejí schválením před zveřejněním. Obvykle to trvá 1–2 dny.
      </p>
    </div>

    <div class="rounded-xl p-8 sm:p-10" style="background-color: var(--color-bg-card); border: 1.5px solid var(--color-border);">

      <form id="metaphor-form" class="space-y-7">
        <!-- Název metafory -->
        <div>
          <label for="nazev" class="block text-sm font-semibold mb-3" style="color: var(--color-text-primary);">
            Název metafory <span style="color: var(--color-negative);">*</span>
          </label>
          <input
            type="text"
            id="nazev"
            name="nazev"
            required
            maxlength="200"
            placeholder="např. Mít máslo na hlavě"
            class="w-full px-4 py-3 rounded-lg font-medium transition-all"
            style="border: 1.5px solid var(--color-border); background-color: var(--color-bg-base); color: var(--color-text-primary);"
            onfocus="this.style.borderColor='var(--color-accent-primary)'"
            onblur="this.style.borderColor='var(--color-border)'"
          />
        </div>

        <!-- Definice -->
        <div>
          <label for="definice" class="block text-sm font-semibold mb-3" style="color: var(--color-text-primary);">
            Definice <span style="color: var(--color-negative);">*</span>
          </label>
          <textarea
            id="definice"
            name="definice"
            required
            rows="3"
            maxlength="500"
            placeholder="Co metafora znamená..."
            class="w-full px-4 py-3 rounded-lg font-medium transition-all"
            style="border: 1.5px solid var(--color-border); background-color: var(--color-bg-base); color: var(--color-text-primary);"
            onfocus="this.style.borderColor='var(--color-accent-primary)'"
            onblur="this.style.borderColor='var(--color-border)'"
          ></textarea>
          <p class="text-xs mt-2" style="color: var(--color-text-tertiary);">Max 500 znaků</p>
        </div>

        <!-- Příklad použití -->
        <div>
          <label for="priklad" class="block text-sm font-semibold mb-3" style="color: var(--color-text-primary);">
            Příklad použití <span style="color: var(--color-negative);">*</span>
          </label>
          <textarea
            id="priklad"
            name="priklad"
            required
            rows="2"
            maxlength="300"
            placeholder="Ukázková věta s použitím metafory..."
            class="w-full px-4 py-3 rounded-lg font-medium transition-all"
            style="border: 1.5px solid var(--color-border); background-color: var(--color-bg-base); color: var(--color-text-primary);"
            onfocus="this.style.borderColor='var(--color-accent-primary)'"
            onblur="this.style.borderColor='var(--color-border)'"
          ></textarea>
          <p class="text-xs mt-2" style="color: var(--color-text-tertiary);">Max 300 znaků</p>
        </div>

        <!-- Zdroj (nepovinné) -->
        <div>
          <label for="zdroj" class="block text-sm font-semibold mb-3" style="color: var(--color-text-primary);">
            Zdroj (nepovinné)
          </label>
          <input
            type="text"
            id="zdroj"
            name="zdroj"
            maxlength="200"
            placeholder="např. Kniha XY, Článek ABC, ..."
            class="w-full px-4 py-3 rounded-lg font-medium transition-all"
            style="border: 1.5px solid var(--color-border); background-color: var(--color-bg-base); color: var(--color-text-primary);"
            onfocus="this.style.borderColor='var(--color-accent-primary)'"
            onblur="this.style.borderColor='var(--color-border)'"
          />
          <p class="text-xs mt-2" style="color: var(--color-text-tertiary);">
            Odkud pochází tato metafora (kniha, článek, atd.)
          </p>
        </div>

        <!-- Jméno autora (nepovinné) -->
        <div>
          <label for="autor_jmeno" class="block text-sm font-semibold mb-3" style="color: var(--color-text-primary);">
            Vaše jméno (nepovinné)
          </label>
          <input
            type="text"
            id="autor_jmeno"
            name="autor_jmeno"
            maxlength="100"
            placeholder="např. Jan Novák"
            class="w-full px-4 py-3 rounded-lg font-medium transition-all"
            style="border: 1.5px solid var(--color-border); background-color: var(--color-bg-base); color: var(--color-text-primary);"
            onfocus="this.style.borderColor='var(--color-accent-primary)'"
            onblur="this.style.borderColor='var(--color-border)'"
          />
        </div>

        <!-- Email autora (nepovinné) -->
        <div>
          <label for="autor_email" class="block text-sm font-semibold mb-3" style="color: var(--color-text-primary);">
            Váš email (nepovinný)
          </label>
          <input
            type="email"
            id="autor_email"
            name="autor_email"
            maxlength="100"
            placeholder="email@priklad.cz"
            class="w-full px-4 py-3 rounded-lg font-medium transition-all"
            style="border: 1.5px solid var(--color-border); background-color: var(--color-bg-base); color: var(--color-text-primary);"
            onfocus="this.style.borderColor='var(--color-accent-primary)'"
            onblur="this.style.borderColor='var(--color-border)'"
          />
          <p class="text-xs mt-2" style="color: var(--color-text-tertiary);">
            Použijeme pouze pro případné dotazy k vaší metafoře
          </p>
        </div>

        <!-- Submit button -->
        <div class="pt-6">
          <button
            type="submit"
            class="w-full font-bold py-4 px-6 rounded-lg hover:transform hover:scale-105 transition-all shadow-sm disabled:opacity-40 disabled:cursor-not-allowed disabled:transform-none"
            style="background-color: var(--color-accent-primary); color: white;"
            onmouseover="if(!this.disabled) this.style.backgroundColor='var(--color-accent-hover)'"
            onmouseout="if(!this.disabled) this.style.backgroundColor='var(--color-accent-primary)'"
          >
            Odeslat metaforu
          </button>
        </div>

        <!-- Status messages -->
        <div id="form-status" class="hidden"></div>
      </form>
    </div>
  </div>
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('metaphor-form') as HTMLFormElement
    const statusDiv = document.getElementById('form-status') as HTMLDivElement
    const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement

    if (!form || !statusDiv || !submitButton) {
      console.error('Form elements not found')
      return
    }

    form.addEventListener('submit', async (e) => {
    e.preventDefault()

    // Disable submit button
    submitButton.disabled = true
    submitButton.textContent = 'Odesílám...'

    // Get form data
    const formData = new FormData(form)
    const data = {
      nazev: formData.get('nazev') as string,
      definice: formData.get('definice') as string,
      priklad: formData.get('priklad') as string,
      zdroj: formData.get('zdroj') as string || null,
      autor_jmeno: formData.get('autor_jmeno') as string || null,
      autor_email: formData.get('autor_email') as string || null
    }

    try {
      const response = await fetch('/api/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })

      const result = await response.json()

      if (response.ok) {
        // Success
        statusDiv.className = 'p-5 rounded-lg font-medium'
        statusDiv.style.backgroundColor = 'var(--color-positive)'
        statusDiv.style.color = 'white'
        statusDiv.style.border = '1.5px solid var(--color-positive)'
        statusDiv.innerHTML = `
          <div class="font-bold mb-2">✅ Metafora úspěšně odeslána!</div>
          <div class="text-sm opacity-95">Zkontrolujeme ji a zveřejníme do 1–2 dnů.</div>
          ${data.autor_email ? '<div class="text-sm opacity-90 mt-2">Po schválení vám pošleme email s potvrzením.</div>' : ''}
        `
        statusDiv.classList.remove('hidden')
        form.reset()
      } else {
        // Error
        statusDiv.className = 'p-5 rounded-lg font-medium'
        statusDiv.style.backgroundColor = 'var(--color-bg-card)'
        statusDiv.style.color = 'var(--color-negative)'
        statusDiv.style.border = '1.5px solid var(--color-negative)'
        statusDiv.textContent = result.error || 'Chyba při odesílání. Zkuste to prosím znovu.'
        statusDiv.classList.remove('hidden')
      }
    } catch (err) {
      statusDiv.className = 'p-5 rounded-lg font-medium'
      statusDiv.style.backgroundColor = 'var(--color-bg-card)'
      statusDiv.style.color = 'var(--color-negative)'
      statusDiv.style.border = '1.5px solid var(--color-negative)'
      statusDiv.textContent = 'Chyba připojení. Zkontrolujte prosím internetové připojení.'
      statusDiv.classList.remove('hidden')
    } finally {
      submitButton.disabled = false
      submitButton.textContent = 'Odeslat metaforu'
    }
    })
  })
</script>
