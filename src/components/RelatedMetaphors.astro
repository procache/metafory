---
import { supabase } from '../lib/supabase'

interface Props {
  slugs: string | string[] | null
}

const { slugs: rawSlugs } = Astro.props

// Normalize to array (handles both string and array input)
const slugs = !rawSlugs
  ? []
  : Array.isArray(rawSlugs)
    ? rawSlugs
    : [rawSlugs]

// Don't render if no related slugs
if (slugs.length === 0) {
  return
}

// Fetch names for related metaphors
const { data: relatedMetaphors } = await supabase
  .from('metaphors')
  .select('slug, nazev')
  .in('slug', slugs)
  .eq('status', 'published')

// Sort in the same order as the input slugs
const sortedMetaphors = slugs
  .map(slug => relatedMetaphors?.find(m => m.slug === slug))
  .filter(Boolean)
---

{sortedMetaphors && sortedMetaphors.length > 0 && (
  <div class="pt-4 border-t" style="border-color: var(--color-border);">
    <h2 class="text-base font-semibold mb-3" style="color: var(--color-text-secondary);">
      Související:
    </h2>
    <ul class="flex flex-wrap gap-3">
      {sortedMetaphors.map((metaphor) => (
        <li>
          <a
            href={`/metafora/${metaphor!.slug}`}
            class="inline-block px-4 py-2 text-base rounded-full transition-colors hover:opacity-80"
            style="background-color: var(--color-bg-sage); color: var(--color-heading-blue);"
          >
            {metaphor!.nazev}
          </a>
        </li>
      ))}
    </ul>
  </div>
)}
